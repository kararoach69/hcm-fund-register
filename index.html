<!-- Replace ONLY the FIRST SECTION (Financial Year Budget) with this: -->

<div class="section">
    <h2>Financial Year 
        <select id="fySelector" onchange="switchFinancialYear()" style="padding: 5px; margin-left: 10px;">
            <option value="">Select FY</option>
        </select>
        <button class="edit-budget" onclick="openBudgetModal()" style="font-size: 14px; padding: 5px 10px;">Edit Budget</button>
        <button onclick="createNewFY()" style="background: #28a745; margin-left: 10px; font-size: 14px; padding: 5px 10px;">âž• New FY</button>
    </h2>
    <div id="currentBudget"></div>
</div>

<!-- Add this NEW function in the <script> section (before loadData()) -->
<script>
function generateFYOptions() {
    const select = document.getElementById('fySelector');
    const currentYear = new Date().getFullYear();
    select.innerHTML = '<option value="">Select FY</option>';
    
    // Generate FY options: 2025-26, 2026-27, 2027-28 (current + past 5 years)
    for(let i = 5; i >= 0; i--) {
        const fy = (currentYear - i) + '-' + (currentYear - i + 1).toString().slice(-2);
        const option = document.createElement('option');
        option.value = fy;
        option.text = fy;
        select.appendChild(option);
    }
}

function createNewFY() {
    const newFY = prompt('Enter new Financial Year (e.g., 2026-27):');
    if (newFY && !data.fyList?.includes(newFY)) {
        if (!data.fyList) data.fyList = [];
        data.fyList.push(newFY);
        switchFinancialYear(newFY);
    }
}

function switchFinancialYear(fy = document.getElementById('fySelector').value) {
    if (!fy) return;
    
    // Load data for this FY (separate storage)
    const saved = localStorage.getItem(`hcmFundData_${fy}`);
    if (saved) {
        data = JSON.parse(saved);
    } else {
        data = { fy: fy, salBudget: 0, allBudget: 0, bills: [] };
    }
    
    calculateAllRunningTotals();
    saveData();
    render();
    generateFYOptions(); // Refresh list
    document.getElementById('fySelector').value = fy;
}

// MODIFY loadData() function - replace existing:
function loadData() {
    generateFYOptions(); // Auto-populate FY dropdown
    const currentFY = data.fy || '2026-27'; // Default
    switchFinancialYear(currentFY);
}

// MODIFY saveData() function:
function saveData() {
    localStorage.setItem(`hcmFundData_${data.fy}`, JSON.stringify(data));
}
</script>
